<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Resources</title>
  <link rel="stylesheet" href="fee.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" 
        integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=home" />
</head>
<body>
  <header>
    <a style="text-decoration: none;" href="https://aits-tpt.edu.in/">
      <h1 id="logo" class="text-danger">ANNAMACHARYA</h1>
    </a>
    <h4 id="logo2">Institute of Technology & Sciences</h4>
    <div class="button">
      <a href="index.html"><button id="one" class="btnn">Home</button></a>
      <a href="fee.html"><button class="btnn">Fee</button></a>
      <a href="tech.html"><button class="btnn">Techevents</button></a>
      <a href="exams.html"><button class="btnn">Exams</button></a>
      <a href="resources.html"><button class="btnn">Resources</button></a>
      <a href="contactus.html"><button class="btnn">Contactus</button></a>
      <br><br>
    </div> 
    <div id="line"></div>
  </header>

  <main>
    <!-- Notifications Section -->
    <div class="container">
      <h2 id="heading">Latest Notifications</h2>
      <ul id="notifications"></ul>
      <div class="footer">Last updated: <span id="lastUpdated"></span></div>
    </div>

    

    <script>
      // ------------------ Notifications ------------------
      const NOTIFICATIONS_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQo44BSVVhk8pwIb30VS9c5BuYwCxFOPzACsO5KsJqGGa9AEHGCq5wEk0vvujdM-ksu3ajTQwahp9Jh/pub?output=csv";
      const dateRegex = /\b\d{1,2}[\/\-.]\d{1,2}[\/\-.]\d{2,4}\b/g;

      async function loadNotifications() {
        try {
          const response = await fetch(NOTIFICATIONS_CSV_URL + "&nocache=" + Date.now(), { cache: "no-store" });
          const text = await response.text();
          const rows = text.split("\n").map(r => r.trim()).filter(r => r);
          const list = document.getElementById("notifications");
          list.innerHTML = "";

          rows.slice(1).reverse().forEach(r => {
            const cols = r.split(",");
            let firstCol = cols[0].replace(/"/g, "").trim();

            if (firstCol && firstCol.toLowerCase() !== "undefined") {
              // Highlight dates
              firstCol = firstCol.replace(
                dateRegex, 
                `<span style="background:yellow; font-weight:bold; padding:2px 4px; border-radius:4px;">$&</span>`
              );

              const li = document.createElement("li");
              li.innerHTML = firstCol;
              list.appendChild(li);
            }
          });

          document.getElementById("lastUpdated").textContent = new Date().toLocaleTimeString();
        } catch (err) {
          console.error("Error loading notifications sheet:", err);
        }
      }

      loadNotifications();
      setInterval(loadNotifications, 7000);

      // ------------------ Downloads Section ------------------
      // Replace YOUR_SHEET_ID and YOUR_SHEET_NAME with your existing sheet's ID and tab name
      const DOWNLOADS_CSV_URL = `https://docs.google.com/spreadsheets/d/1ZkFBPDgL3Gvki4TpRXlu5rMDUlrkeYjAyQXpnKq1TdA/gviz/tq?tqx=out:csv&sheet=ab`;

      async function loadDownloads() {
        try {
          const response = await fetch(DOWNLOADS_CSV_URL + "&nocache=" + Date.now(), { cache: "no-store" });
          const text = await response.text();
          const rows = text.split("\n").map(r => r.trim()).filter(r => r);
          const list = document.getElementById("downloadsList");
          list.innerHTML = "";
          rows.slice(1).forEach(r => {
            const cols = r.split(",");
            let firstCol = cols[0].replace(/"/g, "").trim();

            if (firstCol && firstCol.toLowerCase() !== "undefined") {
              const li = document.createElement("li");
              li.innerHTML = firstCol; // render HTML from sheet
              list.appendChild(li);
            }
          });
        } catch (err) {
          console.error("Error loading downloads sheet:", err);
        }
      }

      loadDownloads();
      setInterval(loadDownloads, 7000);
    </script>
  </main>
</body>
</html>
